#!/bin/bash
# Runtipi Auto-Installation Script

set -e

RUNTIPI_DIR="$HOME/runtipi"
INSTALL_FLAG="$HOME/.runtipi-installed"

# Exit if already installed
if [ -f "$INSTALL_FLAG" ]; then
    echo "Runtipi already installed at $RUNTIPI_DIR"
    exit 0
fi

echo "========================================="
echo "  Runtipi Auto-Installation Starting"
echo "========================================="
echo ""

# Wait for internet (double check)
echo "Checking internet connectivity..."
if ! ping -c 3 8.8.8.8 &>/dev/null; then
    echo "ERROR: No internet connection detected"
    exit 1
fi

echo "Internet connection confirmed!"
echo ""

# Install Runtipi using official installer (runs as user 'runtipi')
echo "Downloading and installing Runtipi..."
echo "This may take several minutes..."
echo ""

curl -L https://setup.runtipi.io | bash

# Mark as installed
touch "$INSTALL_FLAG"

echo ""
echo "========================================="
echo "  Runtipi Installation Complete!"
echo "========================================="
echo ""
echo "Access Runtipi at:"
echo "  http://runtipios.local"
echo "  http://$(hostname -I | awk '{print $1}')"
echo ""
